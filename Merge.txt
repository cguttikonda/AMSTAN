merge 
EZC_PO_ACKNOWLEDGEMENT as ackActual USING (select * from [EZC_PO_ACKNOWLEDGEMENT_TEMP] ) as ackTemp
ON 

ackActual.EZPA_SYS_KEY = ackTemp.EZPA_SYS_KEY
and ackActual.EZPA_SOLD_TO = ackTemp.EZPA_SOLD_TO
and ackActual.EZPA_DOC_NO = ackTemp.EZPA_DOC_NO
and ackActual.EZPA_DOC_STATUS='X'

when matched then

UPDATE  

SET EZPA_DOC_STATUS= 'A',EZPA_MODIFIED_ON=GETDATE(),EZPA_EARLIEST_DATE = ackTemp.EZPA_EARLIEST_DATE, 
	EZPA_LATEST_DATE = ackTemp.EZPA_LATEST_DATE,EZPA_ACKBY_DATE = ackTemp.EZPA_ACKBY_DATE,EZPA_SHIP_DATE = ackTemp.EZPA_SHIP_DATE,
	EZPA_YOUR_REF =ackTemp.EZPA_YOUR_REF,EZPA_OUR_REF =ackTemp.EZPA_OUR_REF,EZPA_ACC_GROUP =ackTemp.EZPA_ACC_GROUP,EZPA_EARLIEST_PLANT =ackTemp.EZPA_EARLIEST_PLANT,
	EZPA_LATEST_PLANT =ackTemp.EZPA_LATEST_PLANT,EZPA_NET_VALUE =ackTemp.EZPA_NET_VALUE ,
	EZPA_TIME_STAMP = ackTemp.EZPA_TIME_STAMP,EZPA_QTY =ackTemp.EZPA_QTY; 

WHERE EZPA_DOC_NO =ackTemp.EZPA_DOC_NO AND EZPA_SOLD_TO =ackTemp.EZPA_SOLD_TO
/**** Added this line too check Version ***/


merge 
EZC_PO_ACKNOWLEDGEMENT as ackActual USING (select * from [EZC_PO_ACKNOWLEDGEMENT_TEMP] ) as ackTemp
ON 

ackActual.EZPA_SYS_KEY = ackTemp.EZPA_SYS_KEY
and ackActual.EZPA_SOLD_TO = ackTemp.EZPA_SOLD_TO
and ackActual.EZPA_DOC_NO = ackTemp.EZPA_DOC_NO
and ackActual.EZPA_DOC_STATUS='Y'

when matched then

UPDATE 

SET EZPA_DOC_STATUS= 'Y',EZPA_MODIFIED_ON=GETDATE(),EZPA_EARLIEST_DATE = ackTemp.EZPA_EARLIEST_DATE, 
	EZPA_LATEST_DATE = ackTemp.EZPA_LATEST_DATE,EZPA_ACKBY_DATE = ackTemp.EZPA_ACKBY_DATE,EZPA_SHIP_DATE = ackTemp.EZPA_SHIP_DATE,
	EZPA_YOUR_REF =ackTemp.EZPA_YOUR_REF,EZPA_OUR_REF =ackTemp.EZPA_OUR_REF,EZPA_ACC_GROUP =ackTemp.EZPA_ACC_GROUP,EZPA_EARLIEST_PLANT =ackTemp.EZPA_EARLIEST_PLANT,
	EZPA_LATEST_PLANT =ackTemp.EZPA_LATEST_PLANT,EZPA_NET_VALUE =ackTemp.EZPA_NET_VALUE ,
	EZPA_TIME_STAMP = ackTemp.EZPA_TIME_STAMP,EZPA_QTY =ackTemp.EZPA_QTY; 

WHERE EZPA_DOC_NO =ackTemp.EZPA_DOC_NO AND EZPA_SOLD_TO =ackTemp.EZPA_SOLD_TO

merge 
EZC_PO_ACKNOWLEDGEMENT as ackActual USING (select * from [EZC_PO_ACKNOWLEDGEMENT_TEMP] ) as ackTemp
ON 

ackActual.EZPA_SYS_KEY = ackTemp.EZPA_SYS_KEY
and ackActual.EZPA_SOLD_TO = ackTemp.EZPA_SOLD_TO
and ackActual.EZPA_DOC_NO = ackTemp.EZPA_DOC_NO
and ackActual.EZPA_DOC_STATUS='A'

when matched then

UPDATE
SET EZPA_DOC_STATUS= 'A',EZPA_MODIFIED_ON=GETDATE(),EZPA_EARLIEST_DATE = ackTemp.EZPA_EARLIEST_DATE, 
	EZPA_LATEST_DATE = ackTemp.EZPA_LATEST_DATE,EZPA_ACKBY_DATE = ackTemp.EZPA_ACKBY_DATE,EZPA_SHIP_DATE = ackTemp.EZPA_SHIP_DATE,
	EZPA_YOUR_REF =ackTemp.EZPA_YOUR_REF,EZPA_OUR_REF =ackTemp.EZPA_OUR_REF,EZPA_ACC_GROUP =ackTemp.EZPA_ACC_GROUP,EZPA_EARLIEST_PLANT =ackTemp.EZPA_EARLIEST_PLANT,
	EZPA_LATEST_PLANT =ackTemp.EZPA_LATEST_PLANT,EZPA_NET_VALUE =ackTemp.EZPA_NET_VALUE ,
	EZPA_TIME_STAMP = ackTemp.EZPA_TIME_STAMP,EZPA_QTY =ackTemp.EZPA_QTY; 


merge 
EZC_PO_ACKNOWLEDGEMENT as ackActual USING (select * from [EZC_PO_ACKNOWLEDGEMENT_TEMP] ) as ackTemp
ON 

ackActual.EZPA_SYS_KEY = ackTemp.EZPA_SYS_KEY
and ackActual.EZPA_SOLD_TO = ackTemp.EZPA_SOLD_TO
and ackActual.EZPA_DOC_NO = ackTemp.EZPA_DOC_NO

when not matched then insert (EZPA_SYS_KEY,EZPA_SOLD_TO,EZPA_DOC_NO,EZPA_DOC_DATE,EZPA_DOC_STATUS,EZPA_CREATED_ON,EZPA_CREATED_BY,EZPA_MODIFIED_ON,EZPA_HEADER_TEXT,EZPA_EXT1,EZPA_EXT2,EZPA_EXT3,EZPA_EARLIEST_DATE,EZPA_LATEST_DATE,EZPA_ACKBY_DATE,EZPA_SHIP_DATE,EZPA_YOUR_REF,EZPA_OUR_REF,EZPA_ACC_GROUP,EZPA_EARLIEST_PLANT,EZPA_LATEST_PLANT,EZPA_NET_VALUE ,EZPA_TIME_STAMP,EZPA_QTY)
values 

(ackTemp.EZPA_SYS_KEY, ackTemp.EZPA_SOLD_TO,ackTemp.EZPA_DOC_NO,ackTemp.EZPA_DOC_DATE,
ackTemp.EZPA_DOC_STATUS,ackTempEZPA_CREATED_ON,ackTemp.EZPA_CREATED_BY,ackTemp.EZPA_MODIFIED_ON,ackTemp.EZPA_HEADER_TEXT,
ackTemp.EZPA_EXT1,ackTemp.EZPA_EXT2,ackTemp.EZPA_EXT3,ackTemp.EZPA_EARLIEST_DATE,ackTemp.EZPA_LATEST_DATE,ackTemp.EZPA_ACKBY_DATE,ackTemp.EZPA_SHIP_DATE,ackTemp.EZPA_YOUR_REF,
ackTemp.EZPA_OUR_REF,ackTemp.EZPA_ACC_GROUP,ackTemp.EZPA_EARLIEST_PLANT,ackTemp.EZPA_LATEST_PLANT,ackTemp.EZPA_NET_VALUE ,ackTemp.EZPA_TIME_STAMP,ackTemp.EZPA_QTY
);


